FROM python:3.12-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

RUN apt-get update \
    && apt-get install -y --no-install-recommends build-essential curl \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY requirements.txt pyproject.toml ./

RUN pip install --no-cache-dir .

COPY src ./src

RUN useradd -m appuser
USER appuser

ENV PAYMENT_AGENT_SERVER_HOST=0.0.0.0 \
    PAYMENT_AGENT_SERVER_PORT=8081 \
    MCP_SERVER_HOST_PAYMENT=payment-tool \
    MCP_SERVER_PORT_PAYMENT=8000 \
    MCP_SERVER_HOST_SALESPERSON=salesperson-tool \
    MCP_SERVER_PORT_SALESPERSON=8001 \
    ADK_WEB_HOST=0.0.0.0 \
    ADK_WEB_PORT=8080

EXPOSE 8000

CMD ["uvicorn", "my_mcp.payment.server_payment_tool:app", "--host", "0.0.0.0", "--port", "8000"]